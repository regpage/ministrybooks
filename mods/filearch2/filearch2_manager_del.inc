<?php
  //////////////////////////////////////////////////////////////////////////////
  // File archive M2
  //////////////////////////////////////////////////////////////////////////////

  //////////////////////////////////////////////////////////////////////////////
  // Файловый менеджер, удаление файла
  //////////////////////////////////////////////////////////////////////////////


  //////////////////////////////////////////////////////////////////////////////
  //инициализация переменных
  //////////////////////////////////////////////////////////////////////////////

  $id_cat   = intval($_GET['id_cat']);
  $state    = intval($_GET['state']);
  $file     = correct_input($_GET['file']);

  //выбираем параметры категории
  $path      = "{$gl_path_to_root}content/_filearch2/".sprintf("%03d", $id_cat)."/";


  //////////////////////////////////////////////////////////////////////////////
  //диалоговое окно подтверждения удаления
  //////////////////////////////////////////////////////////////////////////////

	 if(empty($state))
		{
		  print "<div style='text-align:right'><img src='themes/file_archiv/images/file_archiv.gif'  height='40'></div><h4>{$l_filearch2[77]} {$file}?</h4><div align='center'><br /><br /><a class='chap' href='?mod=filearch2_manager_del&amp;id_cat={$id_cat}&amp;state=1&amp;file={$file}'>{$l_gen[20]}</a> <a class='chap' href='?mod=filearch2_manager_list&amp;id_cat={$id_cat}'>{$l_gen[21]}</a></div>";
		}


  //////////////////////////////////////////////////////////////////////////////
  //удаление файла
  //////////////////////////////////////////////////////////////////////////////

  if($state == 1)
  {
    $to_del = "{$path}{$file}";
    if(file_exists($to_del) && !is_dir($to_del))
      unlink($to_del);

    //переход в список файлов
    echo "<HTML><HEAD><META HTTP-EQUIV='Refresh' CONTENT='0; URL=?mod=filearch2_manager_list&amp;id_cat={$id_cat}'></HEAD></HTML>";
    exit;
  }

  print "<br />";
  print "<br />";


?>