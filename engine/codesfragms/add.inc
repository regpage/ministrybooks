<?php
  //////////////////////////////////////////////////////////////////////////////
  // Система управления фрагментами кода
  //////////////////////////////////////////////////////////////////////////////

  //////////////////////////////////////////////////////////////////////////////
  //Модуль добавляет фрагмент кода
  //////////////////////////////////////////////////////////////////////////////


  //////////////////////////////////////////////////////////////////////////////
  //обработчик формы
  //////////////////////////////////////////////////////////////////////////////

  if(!empty($_POST))
  {
    //фильтрация данных формы
    $file  = correct_input($_POST['file']);

    if(preg_match("/[^a-z0-9_]/i", $file) || strlen($file) == 0)
      $errors[] = $l_codefragms[13];
    elseif(preg_match("/[0-9]/i", $file[0]))
      $errors[] = $l_codefragms[14];

    //сохраняем код в файле
    save_in_file("{$gl_path_to_root}codesfragms/{$file}", '', 'w');

    //осуществляем переход в список фрагментов
    echo "<HTML><HEAD><META HTTP-EQUIV='Refresh' CONTENT='0; URL=?adm=codesfragms_list'></HEAD></HTML>";
    return;

  }


  //////////////////////////////////////////////////////////////////////////////
  //форма
  //////////////////////////////////////////////////////////////////////////////

  //заголовок
  print "<h1>{$l_codefragms[11]}</h1>";

  //подключаем форму
  include("{$gl_path_to_engine}codesfragms/_edit.inc");

  //ссылка "назад"
  print "<p><a class='Mustgreen' href='?adm=codesfragms_list'>{$l_codefragms[12]}</a></p>";

?>