<?php
  //////////////////////////////////////////////////////////////////////////////
  // Конструктор меню
  //////////////////////////////////////////////////////////////////////////////

  //////////////////////////////////////////////////////////////////////////////
  //Модуль удаляет меню $id_menu
  //////////////////////////////////////////////////////////////////////////////


  //////////////////////////////////////////////////////////////////////////////
  //инициализация переменных
  //////////////////////////////////////////////////////////////////////////////

	 $id_menu = intval($_GET['id_menu']);
	 $state    = intval($_GET['state']);

  //выборка параметров удаляемого меню
  $query = "SELECT pos
              FROM {$gl_db_prefix}menu
             WHERE id_menu  = {$id_menu}";
  $results = db_select($query);
  $pos = $results[0]['pos'];
  unset($results);


  //////////////////////////////////////////////////////////////////////////////
  //диалоговое окно подтверждения
  //////////////////////////////////////////////////////////////////////////////

  if(empty($state))
  {
    print "<h1>{$l_menu[23]}</h1><br><br><br><br><br><div align='center'><br><br><a href='?adm=menu_del&id_menu={$id_menu}&state=1'>{$l_adm_gen[5]}</a> <a href='?adm=menu_list'>{$l_adm_gen[6]}</a></div>";
  }


  //////////////////////////////////////////////////////////////////////////////
  //удаление меню
  //////////////////////////////////////////////////////////////////////////////

  if($state == 1)
  {
    //удаление меню
    $query = "DELETE FROM {$gl_db_prefix}menu_items
               WHERE id_menu = {$id_menu}";
    db_delete($query);

    $query = "DELETE FROM {$gl_db_prefix}menu
               WHERE id_menu = {$id_menu}";
    db_delete($query);

    //калибруем позицию
    $query = "UPDATE {$gl_db_prefix}menu
                 SET pos = pos - 1
               WHERE pos > {$pos}";
    db_update($query);

    //переходим в список меню
    echo "<HTML><HEAD><META HTTP-EQUIV='Refresh' CONTENT='0; URL=?adm=menu_list'></HEAD></HTML>";
    exit;
  }



?>