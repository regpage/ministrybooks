<?php
  //////////////////////////////////////////////////////////////////////////////
  // Система управления разделами и страницами
  //////////////////////////////////////////////////////////////////////////////

  //////////////////////////////////////////////////////////////////////////////
  //Модуль подключает ANTF blockeditor/WYSIWYG редактор
  //для редактирования текста страницы id_item
  //////////////////////////////////////////////////////////////////////////////


  //////////////////////////////////////////////////////////////////////////////
  //сохраняем нужные get - переменные в сессии
  //////////////////////////////////////////////////////////////////////////////

  if(!empty($_GET['id_part']))
  {
    $id_part = intval($_GET['id_part']);
    $_SESSION['be_id_part'] = $id_part;
    $id_item = intval($_GET['id_item']);
    $_SESSION['be_id_item'] = $id_item;
  }
  else
  {
    $id_part = intval($_SESSION['be_id_part']);
    $id_item = intval($_SESSION['be_id_item']);
  }

  //////////////////////////////////////////////////////////////////////////////
  // Формируем ссылку "Назад"
  //////////////////////////////////////////////////////////////////////////////

  //выбираем название раздела
  $query = "SELECT title
              FROM {$gl_db_prefix}parts
             WHERE id_part = {$id_part}";
  $ed_part_title = stripslashes(db_select_one($query));

  $ed_back_href = "<a href='?adm=parts_list&id_part_prec={$id_part}'>{$l_parts[64]} &laquo;{$ed_part_title}&raquo;</a>";


  //////////////////////////////////////////////////////////////////////////////
  // Формируем заголовок списка блоков
  //////////////////////////////////////////////////////////////////////////////

  $query = "SELECT title
              FROM {$gl_db_prefix}parts_items
             WHERE id_item = {$id_item}";
  $ed_pg_title = stripslashes(db_select_one($query));
  //$ed_h1_prefix = "{$l_pages[5]} :: {$ed_part_title} :: {$l_parts[65]} :: {$ed_pg_title}";
  $ed_h1_prefix = "{$ed_part_title} :: {$ed_pg_title}";


  //////////////////////////////////////////////////////////////////////////////
  // Формируем ключевые переменные редактора
  //////////////////////////////////////////////////////////////////////////////

  //адрес этого модуля (без переменных редактора)
  $ed_url = "?adm=parts_items_pages_text";
  //префикс таблиц {prefix}_blocks и {prefix}_images
  $ed_tbl_pref = 'pages';
  //текущая страница редактора
  $ed_opt = preg_replace("/[^a-z0-9_]/", '', $_GET['ed_opt']);
  //id_item редактируемой страницы
  $ed_pg  = preg_replace("/[^a-z0-9_]/", '', $_GET['pg']);
  if(empty($ed_pg))
    $ed_pg  = preg_replace("/[^a-z0-9_]/", '', $_POST['pg']);


  //////////////////////////////////////////////////////////////////////////////
  // Формируем ключевые переменные редактора, пути
  //////////////////////////////////////////////////////////////////////////////

  //путь к директории редактора
  $ed_path_to_editor = "{$gl_path_to_engine}blockeditor/";
  //путь к директории, где сохраняется сама страница и файлы, относящиеся к ней
  $ed_path_to_file   = "{$gl_path_to_root}content/{$ed_pg}/";
  //путь к директории, где сохраняется изображения страницы
  $ed_path_to_img   = "{$gl_path_to_root}content/{$ed_pg}/";
  //url для изображений
  $ed_path_to_img_for_url = "content/{$ed_pg}/";
  //ссылка на страницу
  $ed_page_preview_href = "?mb={$ed_pg}";


  //////////////////////////////////////////////////////////////////////////////
  // Подключаем модули редактора
  //////////////////////////////////////////////////////////////////////////////

  //функции редактора
  include("{$ed_path_to_editor}func.inc");

  //выбор текущей страницы редактора в зависимости от значения переменной ed_opt
  include("{$ed_path_to_editor}blocks_pages.inc");

  //ссылка назад
  print "<p>{$ed_back_href}</p>";

?>